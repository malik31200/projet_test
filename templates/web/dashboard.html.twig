{% extends 'base.html.twig' %}

{% block title %}Mon espace - Actual Sport{% endblock %}

{% block body %}
    <h1 class="page-title">ğŸ‘¤ Mon espace</h1>

    {# Mes rÃ©servations de sessions #}
    <div class="dashboard-section">
        <h2 class="section-title">ğŸ“… Mes rÃ©servations</h2>
        {% if registrations is empty %}
            <div class="card">
                <p class="text-muted">Vous n'avez aucune rÃ©servation pour le moment.</p>
                <a href="{{ path('app_sessions') }}" class="btn">RÃ©server une session</a>
            </div>
        {% else %}
            <div class="grid">
                {% for registration in registrations %}
                    <div class="card">
                        <div class="flex-between">
                            <h3>{{ registration.session.course.name }}</h3>
                            <span class="badge badge-{{ registration.status }}">
                                {{ registration.status }}
                            </span>
                        </div>
                        
                        <div class="session-details">
                            <div class="detail-item">
                                <span class="detail-label">ğŸ“… Date</span>
                                <strong>{{ registration.session.startTime|date('d/m/Y') }}</strong>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ğŸ• Horaire</span>
                                <strong>{{ registration.session.startTime|date('H:i') }} - {{ registration.session.endTime|date('H:i') }}</strong>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ğŸ“ Inscrit le</span>
                                <span>{{ registration.registeredAt|date('d/m/Y') }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ğŸ’° Prix</span>
                                <strong>{{ registration.session.course.price }} â‚¬</strong>
                            </div>
                        </div>

                        {% if registration.status == 'confirmed' %}
                            {% set now = date() %}
                            {% set sessionStart = registration.session.startTime %}
                            {% set hoursDiff = (sessionStart.timestamp - now.timestamp) / 3600 %}
                            
                            {% if hoursDiff >= 24 %}
                                <form method="POST" action="{{ path('app_registration_cancel', {id: registration.id}) }}" style="margin-top: 1rem;" onsubmit="return confirm('ÃŠtes-vous sÃ»r de vouloir annuler cette rÃ©servation ?');">
                                    <button type="submit" class="btn btn-danger btn-full">
                                        âŒ Annuler la rÃ©servation
                                    </button>
                                </form>
                            {% else %}
                                <div class="alert alert-error" style="margin-top: 1rem; padding: 0.75rem;">
                                    âš ï¸ Trop tard pour annuler (dÃ©lai minimum : 24h)
                                </div>
                            {% endif %}

                        {% elseif registration.status == 'cancelled' %}
                            <div class="alert alert-error" style="margin-top: 1rem; padding: 0.75rem;">
                                ğŸš« AnnulÃ©e le {{ registration.cancelledAt|date('d/m/Y Ã  H:i') }}

                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    {# Mes paiements #}
    <div class="dashboard-section">
        <h2 class="section-title">ğŸ’° Historique des paiements</h2>
        {% if payments is empty %}
            <div class="card">
                <p class="text-muted">Aucun paiement enregistrÃ©.</p>
            </div>
        {% else %}
            <div class="grid">
                {% for payment in payments %}
                    <div class="card">
                        <div class="flex-between">
                            <div>
                                <strong style="font-size: 1.2rem;">{{ payment.amount }} â‚¬</strong>
                                <p class="text-muted" style="margin-top: 0.5rem;">
                                    {{ payment.createdAt|date('d/m/Y Ã  H:i') }}
                                </p>
                            </div>
                            <span class="badge badge-success">PayÃ©</span>
                        </div>
                        {% if payment.registration %}
                            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">
                                <p><strong>Session :</strong> {{ payment.registration.session.course.name }}</p>
                                <p class="text-muted">{{ payment.registration.session.startTime|date('d/m/Y Ã  H:i') }}</p>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endblock %}